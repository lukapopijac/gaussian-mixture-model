(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))e(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function s(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(l){if(l.ep)return;l.ep=!0;const n=s(l);fetch(l.href,n)}})();class N extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.shadowRoot.innerHTML=`
			<style>
				a {
					position: absolute;
					top: 14px;
					right: 14px;
					font-family: sans-serif;
					font-weight: normal;
					font-size: 16px;
					line-height: normal;
					color: blue;
					cursor: pointer;
					overflow: hidden;
					pointer-events: auto;
					text-decoration: none;
					border: 1px solid blue;
					padding: 6px 10px;
					border-radius: 4px;
					background: rgba(255,255,255,0.3);
				}
			</style>
			<a href="${this.getAttribute("href")}">GitHub</a>
		`}}customElements.define("github-link",N);const z=Math.sqrt(5.99146);class H{constructor(r,s,e,l,n){this.canvas=r,this.xMin=s,this.xMax=e,this.yMin=l,this.yMax=n,this.xRangeInv=1/(e-s),this.yRangeInv=1/(n-l),this.ctx=r.getContext("2d")}_point2pixel(r){return{x:this.canvas.width*this.xRangeInv*(r[0]-this.xMin),y:this.canvas.height*this.yRangeInv*(r[1]-this.yMin)}}points(r,s){this.canvas.width,this.canvas.height;for(let e=0;e<r.length;e++){let l=r[e];this.ctx.lineWidth=.2,this.ctx.strokeStyle="black",this.ctx.fillStyle=s?s[e]:"grey",this.ctx.beginPath();let{x:n,y:a}=this._point2pixel(l);this.ctx.arc(n,a,3.5,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke()}}ellipse(r,s,e){e||(e="black"),this.canvas.width,this.canvas.height;let l=s[0][0],n=s[0][1],a=s[1][1],i=l+a,h=Math.sqrt(i*i*.25-l*a+n*n),o=.5*i+h,c=.5*i-h,u=Math.sqrt(o)*z,p=Math.sqrt(c)*z,f=u*this.canvas.width*this.xRangeInv,d=p*this.canvas.height*this.yRangeInv,C=Math.atan2(n,o-a),{x:m,y}=this._point2pixel(r);this.ctx.globalAlpha=.7,this.ctx.strokeStyle=e,this.ctx.fillStyle=e,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.ellipse(m,y,f,d,C,0,2*Math.PI),this.ctx.stroke(),this.ctx.globalAlpha=1}singularity(r){let s=this.canvas.width,e=this.canvas.height,{x:l,y:n}=this._point2pixel(r),a=4,i=14,h=7,o="SINGULARITY",c=20;this.ctx.font="bold "+c+"px sans-serif";let u=this.ctx.measureText(o).width;this.ctx.scale(1,-1),this.ctx.textAlign="center",this.ctx.textBaseline="middle";let p=n<.5*e?1:-1,f=n+100*p,d=l<.5*s?l+.5*u:l-.5*u;d+.5*u+i+a>s&&(d=s-.5*u-i-a),d-.5*u-i-a<0&&(d=.5*u+i+a),f-.5*c-i-a<0&&(f=.5*c+i+a),f+.5*c+i+a>e&&(f=e-.5*c-i-a),this.ctx.beginPath(),this.ctx.moveTo(l,-n),this.ctx.lineTo(d-15,-f+(.5*c+i)*p),this.ctx.lineTo(d-.5*u-i+h,-f+(.5*c+i)*p),this.ctx.arcTo(d-.5*u-i,-f+(.5*c+i)*p,d-.5*u-i,-f+(.5*c+i-h)*p,h),this.ctx.lineTo(d-.5*u-i,-f+(-.5*c-i+h)*p),this.ctx.arcTo(d-.5*u-i,-f+(-.5*c-i)*p,d-.5*u-i+h,-f+(-.5*c-i)*p,h),this.ctx.lineTo(d+.5*u+i-h,-f+(-.5*c-i)*p),this.ctx.arcTo(d+.5*u+i,-f+(-.5*c-i)*p,d+.5*u+i,-f+(-.5*c-i+h)*p,h),this.ctx.lineTo(d+.5*u+i,-f+(.5*c+i-h)*p),this.ctx.arcTo(d+.5*u+i,-f+(.5*c+i)*p,d+.5*u+i-h,-f+(.5*c+i)*p,h),this.ctx.lineTo(d+15,-f+(.5*c+i)*p),this.ctx.closePath(),this.ctx.fillStyle="rgba(255,30,30,.85)",this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.fillText(o,d,-f)}}function W(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var X={determinant:Y,inverse:V,cholesky:q};function Y(t,r){if(typeof t=="number")return t;if(t.length==1)return t[0][0];if(t.length==2)return t[0][0]*t[1][1]-t[0][1]*t[1][0];if(t.length==3)return r?Math.pow(r[0][0]*r[1][1]*r[2][2],2):t[0][0]*(t[1][1]*t[2][2]-t[1][2]*t[2][1])+t[0][1]*(t[1][2]*t[2][0]-t[1][0]*t[2][2])+t[0][2]*(t[1][0]*t[2][1]-t[1][1]*t[2][0]);for(var s=1,e=r||q(t),l=0;l<t.length;l++)s*=e[l][l];return s*s}function V(t,r){if(typeof t=="number")return 1/t;if(t.length==1)return[[1/t[0][0]]];if(t.length==2){var s=t[0][0],e=t[0][1],l=t[1][1],n=1/(s*l-e*e);return[[l*n,-e*n],[-e*n,s*n]]}else if(t.length==3){var s=t[0][0],l=t[1][0],a=t[1][1],i=t[2][0],h=t[2][1],o=t[2][2],c=a*o-h*h,u=h*i-l*o,p=s*o-i*i,f=l*h-a*i,d=l*i-s*h,C=s*a-l*l,m=1/(s*c+l*u+i*f);return[[c*m,u*m,f*m],[u*m,p*m,d*m],[f*m,d*m,C*m]]}for(var y=K(r||q(t)),o=0;o<y.length;o++)for(var M=0;M<=o;M++){for(var I=0,E=o;E<y.length;E++)I+=y[E][o]*y[E][M];y[o][M]=I,y[M][o]=I}return y}function q(t){if(typeof t=="number")return Math.sqrt(t);var r=t.length;if(r==1)return[[Math.sqrt(t[0][0])]];for(var s=Array(r),e=0;e<r;e++)for(var l=s[e]=Array(r).fill(0),n=0;n<e+1;n++){for(var a=s[n],i=t[e][n],h=0;h<n;h++)i-=l[h]*a[h];l[n]=e==n?Math.sqrt(i):i/a[n]}return s}function K(t){for(var r=t.length,s=Array(r),e=0;e<r;e++)s[e]=Array(r);for(var l=0;l<r;l++){s[l][l]=1/t[l][l];for(var e=l+1;e<r;e++){for(var n=0,a=l;a<e;a++)n-=t[e][a]*s[a][l];s[e][l]=n/t[e][e]}}return s}const b=W(X);class U{constructor({weights:r,means:s,covariances:e,bufferSize:l}){this.dimensions=s[0].length,this.clusters=s.length,this.weights=r?r.slice():Array(this.clusters).fill(1/this.clusters),this.means=s.map(n=>n.slice()),this.covariances=e.map(n=>n.map(a=>a.slice())),this.bufferSize=l??1e6,this.data=Array(this.bufferSize),this.idx=0,this.dataLength=0,this.tmpArr=new Float32Array(this.bufferSize),this.cResps=Array(this.clusters);for(let n=0;n<this.clusters;n++)this.cResps[n]=new Float32Array(this.bufferSize);this.singularity=null,this.covCholeskies=null,this.covDeterminants=this.covariances.map(n=>b.determinant(n))}addPoint(r){this.data[this.idx]=r,this.idx++,this.idx==this.bufferSize&&(this.idx=0),this.dataLength<this.bufferSize&&this.dataLength++}runEM(r=1){if(this.dataLength!=0)for(let s=0;s<r;s++){if($.call(this),J.call(this),this.dimensions>3){this.covCholeskies=Array(this.clusters);for(let e=0;e<this.clusters;e++)this.covCholeskies[e]=b.cholesky(this.covariances[e])}for(let e=0;e<this.clusters;e++){let l=this.covCholeskies&&this.covCholeskies[e];this.covDeterminants[e]=b.determinant(this.covariances[e],l)}for(let e=0;e<this.clusters;e++)if(this.covDeterminants[e]<=0)return this.singularity=this.means[e],this.singularity}}predict(r){let s=Array(this.clusters);for(let e=0;e<this.clusters;e++){let l=this.weights[e],n=this.means[e],a=this.covariances[e],i=this.covDeterminants[e],h=this.covCholeskies&&this.covCholeskies[e];s[e]=l*D(r,n,a,i,h)}return s}predictNormalize(r){let s=this.predict(r),e=0;for(let n=0;n<this.clusters;n++)e+=s[n];let l=1/e;for(let n=0;n<this.clusters;n++)s[n]*=l;return s}}function $(){this.tmpArr.fill(0,0,this.dataLength);for(let t=0;t<this.clusters;t++){let r=this.cResps[t],s=this.weights[t],e=this.means[t],l=this.covariances[t],n=this.covDeterminants[t],a=this.covCholeskies&&this.covCholeskies[t];for(let i=0;i<this.dataLength;i++)this.tmpArr[i]+=r[i]=s*D(this.data[i],e,l,n,a)}for(let t=0;t<this.dataLength;t++)this.tmpArr[t]=1/this.tmpArr[t];for(let t=0;t<this.clusters;t++){let r=this.cResps[t];for(let s=0;s<this.dataLength;s++)r[s]*=this.tmpArr[s]}}function J(){for(let t=0;t<this.clusters;t++){let r=this.cResps[t],s=0;for(let i=0;i<this.dataLength;i++)s+=r[i];let e=1/s;this.weights[t]=s/this.dataLength;let l=this.means[t].fill(0);for(let i=0;i<this.dataLength;i++)for(let h=0;h<this.dimensions;h++)l[h]+=r[i]*this.data[i][h];for(let i=0;i<this.dimensions;i++)l[i]*=e;let n=this.covariances[t];for(let i=0;i<this.dimensions;i++)n[i].fill(0);let a=Array(this.dimensions);for(let i=0;i<this.dataLength;i++){let h=this.data[i];for(let o=0;o<this.dimensions;o++)a[o]=h[o]-l[o];for(let o=0;o<this.dimensions;o++)for(let c=0;c<this.dimensions;c++)n[o][c]+=r[i]*a[o]*a[c]}for(let i=0;i<this.dimensions;i++)for(let h=0;h<this.dimensions;h++)n[i][h]*=e}}const Q=Math.log(2*Math.PI);function D(t,r,s,e,l){let n=typeof t=="number"?1:t.length,a=l||(n>3?b.cholesky(s):null),i=e!=null?1/e:1/b.determinant(s,a),h=Z(b.inverse(s,a),r,t);return Math.sqrt(i)*Math.exp(-.5*(h+n*Q))}function Z(t,r,s){if(typeof s=="number")return t*(s-r)*(s-r);if(s.length==1)return t[0][0]*(s[0]-r[0])*(s[0]-r[0]);if(s.length==2){let i=s[0]-r[0],h=s[1]-r[1];return t[0][0]*i*i+(t[0][1]+t[1][0])*i*h+t[1][1]*h*h}let e=0,l=s.length,n,a;for(n=0;n<l;n++)for(a=0;a<l;a++)e+=t[n][a]*(s[n]-r[n])*(s[a]-r[a]);return e}const v=document.querySelector(".graph canvas"),w=-100,T=100,L=-100,R=100,_=["rgb(228,  26,  28)","rgb( 55, 126, 184)","rgb( 77, 175,  74)","rgb(152,  78, 163)","rgb(255, 127,   0)","rgb(255, 255,  51)","rgb(166,  86,  40)"],x=[];let g=null;x.push([-49,64],[-48,57],[-44,58],[-42,52],[-37,45],[-37,49],[-40,55],[-34,47],[-31,43],[-32,40],[-37,42],[-42,48],[-46,54],[-31,39],[-28,41],[-28,38],[-34,37],[-31,0],[-37,0],[-44,-7],[-51,-17],[-51,-28],[-41,-30],[-24,-20],[-18,-14],[-20,-4],[-26,-1],[-34,-27],[-27,-9],[-35,-13],[-45,-20],[-35,-19],[-31,-15],[-35,-5],[-40,-14],[-38,-16],[-36,-14],[-33,-12],[-30,-10],[57,-34],[54,-37],[52,-38],[50,-41],[46,-45],[45,-46],[42,-51],[39,-55],[37,-58],[34,-62],[30,-66],[27,-69],[25,-72],[22,-77],[19,-80],[17,-83],[14,-86],[12,-89],[24,-74],[26,-68],[28,-65],[31,-61],[35,-58],[37,-57],[38,-54],[43,-50],[37,-60],[36,-61],[34,-63],[29,-66],[21,-32],[28,-39],[38,-43],[55,-49],[66,-43],[72,-33],[73,-17],[62,-7],[52,-1],[40,-1],[32,-3],[25,-9],[23,-20],[28,-28],[60,-29],[63,-26],[42,-47],[42,-52],[46,-49],[49,-43],[38,-48],[40,-51],[33,-55],[32,-65],[41,-12],[36,-17],[57,-14],[63,-17],[63,-33],[54,-22],[43,-23],[41,-35],[59,-40],[49,-28],[49,-18],[33,-33],[37,-27],[47,-35],[49,-21],[46,-26],[51,-28],[55,-26]);v.addEventListener("click",function(t){let r=v.width,s=v.height,e=[t.offsetX/r*(T-w)+w,t.offsetY/s*(R-L)+L],l=document.getElementById("number-of-points"),n=Number(l.options[l.selectedIndex].text);if(n==1)x.push(e),g&&g.addPoint(e);else for(let a=0;a<n;a++){let i=Math.random()*2*Math.PI/n+a/n*2*Math.PI,h=Math.random()*(T-w)*.04,o=[e[0]+h*Math.cos(i),e[1]+h*Math.sin(i)];x.push(o),g&&g.addPoint(o)}P()});const j=document.querySelector(".graph .y-axis"),O=document.querySelector(".graph .canvas-wrapper"),k=window.getComputedStyle(O,null),S=new H(v,w,T,L,R);B();window.addEventListener("resize",B);function B(){let t=parseFloat(k.getPropertyValue("width")),r=parseFloat(k.getPropertyValue("padding-left")),s=parseFloat(k.getPropertyValue("padding-top")),e=t-2*r+2*s;O.style.height=e+"px",j.style.height=e+"px",v.width=v.scrollWidth,v.height=v.scrollHeight,P()}function P(){if(v.width=v.width,g){let t=x.map(r=>g.predict(r)).map(r=>r.reduce((s,e,l,n)=>e>n[s]?l:s,0)).map(r=>_[r]);for(let r=0;r<g.clusters;r++)S.ellipse(g.means[r],g.covariances[r],_[r]);S.points(x,t),g.singularity&&S.singularity(g.singularity)}else S.points(x)}document.getElementById("btn-clear").addEventListener("click",function(){x.length=0,g=null,P()});document.getElementById("btn-run-a").addEventListener("click",t=>F(1));document.getElementById("btn-run-b").addEventListener("click",t=>F(10));document.getElementById("btn-init-clusters").addEventListener("click",function(){G(),P()});function F(t){if(g){if(g.singularity)return;g.runEM(t)}else G();P()}function G(){let t=document.getElementById("number-of-clusters"),r=Number(t.options[t.selectedIndex].text),s=T-w,e=R-L,l=Array(r).fill(0).map(a=>[w+Math.random()*s,L+Math.random()*e]),n=Array(r).fill(0).map(a=>[[s*s*.01,0],[0,e*e*.01]]);g=new U({dimensions:2,bufferSize:1e3,weights:Array(r).fill(1/r),means:l,covariances:n}),x.forEach(a=>g.addPoint(a))}
